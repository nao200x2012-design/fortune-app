<!doctype html>
<html lang="ja" class="size-m">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ç”°æ©‹ çŸ¢ç”·ç„¡ ã® å ã„</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body class="premium"> 
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>
    <div class="shooting-star"></div>

    <div class="star-flicker"></div>
    <div class="star-flicker"></div>
    <div class="star-flicker"></div>
    <div class="star-flicker"></div>
    <div class="star-flicker"></div>
    <div class="star-flicker"></div>

    <div class="wrap">
    <div class="card">
      <div class="box">
        <div class="toolbar">
          <div class="seg" role="group" aria-label="æ–‡å­—ã‚µã‚¤ã‚º">
            <button id="fs-s">å°</button>
            <button id="fs-m" class="active">ä¸­</button>
            <button id="fs-l">å¤§</button>
          </div>
          <label class="save-toggle"><input id="saveToggle" type="checkbox"> å…¥åŠ›ã‚’ä¿å­˜</label>
          <div class="seg" role="group" aria-label="ãƒ¢ãƒ¼ãƒ‰">
            <button id="mode-hon" class="active">è¡¨ãƒ¢ãƒ¼ãƒ‰</button>
            <button id="mode-ura">è£ãƒ¢ãƒ¼ãƒ‰</button>
          </div>
        </div>

        <div class="title">
          <h1>
            <ruby>ç”°<rt>ãŸ</rt></ruby><ruby>æ©‹<rt>ã°ã—</rt></ruby>
            <span class="sp"></span>
            <ruby>çŸ¢<rt>ã‚„</rt></ruby><ruby>ç”·<rt>ãŠ</rt></ruby><ruby>ç„¡<rt>ãª</rt></ruby>
            <span class="sp"></span>ã®<span class="sp"></span>
            <ruby>å <rt>ã†ã‚‰</rt></ruby>ã„
          </h1>
        </div>

        <div class="grid g4" style="margin-top:18px">
          <div>
            <label>ç”Ÿã¾ã‚Œå¹´</label>
            <select id="year"></select>
          </div>
          <div>
            <label>æœˆ</label>
            <select id="month"></select>
          </div>
          <div>
            <label>æ—¥</label>
            <select id="day"></select>
          </div>
          <div>
            <label>æ€§åˆ¥</label>
            <select id="gender">
              <option value="ç”·æ€§">ç”·æ€§</option>
              <option value="å¥³æ€§">å¥³æ€§</option>
              <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
          </div>

          <div class="col-2">
            <label>ãƒ†ãƒ¼ãƒ</label>
            <select id="theme">
              <option value="ç·é‹">ç·é‹</option>
              <option value="é‡‘é‹">é‡‘é‹</option>
              <option value="ä»•äº‹é‹">ä»•äº‹é‹</option>
              <option value="æ‹æ„›é‹">æ‹æ„›é‹</option>
              <option value="äººé–“é–¢ä¿‚">äººé–“é–¢ä¿‚</option>
              <option value="å¥åº·é‹">å¥åº·é‹</option>
            </select>
          </div>

          <div class="col-2">
            <label>å è¡“ï¼ˆè¤‡æ•°å¯ï¼æœªé¸æŠãªã‚‰ãƒŸãƒƒã‚¯ã‚¹ï¼‰</label>
            <div id="methods" class="methods">
              <label><input type="checkbox" value="å››æŸ±æ¨å‘½"> å››æŸ±æ¨å‘½</label>
              <label><input type="checkbox" value="ã‚¿ãƒ­ãƒƒãƒˆ"> ã‚¿ãƒ­ãƒƒãƒˆ</label>
              <label><input type="checkbox" value="æ•°ç§˜è¡“"> æ•°ç§˜è¡“</label>
              <label><input type="checkbox" value="å‹•ç‰©å ã„"> å‹•ç‰©å ã„</label>
              <label><input type="checkbox" value="ä¹æ˜Ÿæ°—å­¦"> ä¹æ˜Ÿæ°—å­¦</label>
              <label><input type="checkbox" value="è¥¿æ´‹å æ˜Ÿè¡“"> è¥¿æ´‹å æ˜Ÿè¡“</label>
              <label id="sexualMethod" style="display:none;"><input type="checkbox" value="èª˜æƒ‘ã®ç§˜è¡“"> èª˜æƒ‘ã®ç§˜è¡“</label>
              <label><input type="checkbox" value="ãƒŸãƒƒã‚¯ã‚¹"> ãƒŸãƒƒã‚¯ã‚¹</label>
            </div>
            <div class="hint">â€» ä½•ã‚‚é¸ã°ãªã‘ã‚Œã°ã€ŒãƒŸãƒƒã‚¯ã‚¹ã€æ‰±ã„ã«ãªã‚Šã¾ã™ã€‚</div>
          </div>

          <div class="col-2">
            <label>ï¼ˆä»»æ„ï¼‰ãƒ™ãƒ¼ã‚¹æƒ…å ±</label>
            <input id="base" type="text" placeholder="ä¾‹ï¼‰è»¢è·ã‚’æ¤œè¨ï¼å‡ºè²»ãŒç¶šã ãªã©"/>
          </div>
          <div class="col-2">
            <label>ï¼ˆä»»æ„ï¼‰é¡˜ã„ãƒ»æ¡ä»¶</label>
            <input id="wish" type="text" placeholder="ä¾‹ï¼‰æ˜‡çµ¦ã—ãŸã„ï¼å®‰å®šåå…¥ãŒæ¬²ã—ã„ï¼ç´ æ•µãªå‡ºä¼šã„ ãªã©"/>
          </div>

          <div class="col-4">
            <button id="run" class="btn">å ã†ï¼ï¼ˆçµæœã‚’è¡¨ç¤ºï¼‰</button>
            <div class="note">â€»ã‚¯ãƒªãƒƒã‚¯ã‹ã‚‰æ•°ç§’ã€œæ•°åç§’ã§è¡¨ç¤ºã•ã‚Œã¾ã™</div>
          </div>
        </div>

        <div id="res" class="result"></div>

        <div id="bio" class="card cal-card" style="display:none">
          <h3 class="cal-title">âœ¨ 2é€±é–“ã®ãƒ©ãƒƒã‚­ãƒ¼ãƒã‚¤ã‚ªãƒªã‚ºãƒ  âœ¨</h3>
          <div class="legend">
            <span class="badge b-star">â­ å…¨ä½“é‹ãŒè‰¯ã„æ—¥</span>
            <span class="badge b-heart">â¤ï¸ æ‹æ„›é‹ãŒè‰¯ã„æ—¥</span>
            <span class="badge b-money">ğŸ’° é‡‘é‹ãŒè‰¯ã„æ—¥</span>
            <span class="badge b-work">ğŸ’¼ ä»•äº‹é‹ãŒè‰¯ã„æ—¥</span>
            <span class="badge b-rest">ğŸ€ ä¼‘ã¿ã®æ—¥ï¼ˆã‚†ã£ãã‚Šï¼‰</span>
          </div>
          <div class="weekbar"><span>æ—¥</span><span>æœˆ</span><span>ç«</span><span>æ°´</span><span>æœ¨</span><span>é‡‘</span><span>åœŸ</span></div>
          <div id="days" class="grid14"></div>
          <div class="note">â€» â­ã®æ—¥ã«è¡Œå‹•ã™ã‚‹ã¨è‰¯ã„çµæœã«ã¤ãªãŒã‚Šã‚„ã™ã„ã§ã™ã€‚</div>
        </div>

      </div>
      <div id="usage-meter" class="usage-meter" style="text-align:right; margin-top:10px;">
        æœ¬ç«¯æœ«ã§ã®åˆ©ç”¨å›æ•°ï¼š<span id="usage-count">0</span>å›
      </div>
    </div>
    <div class="footer">Â© Tabashi-Yaona</div> </div>

<script>
/* ========= util ========= */
const $ =(s,p=document)=>p.querySelector(s);
const esc=s=>String(s??"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[m]));
function toYMD(d){const z=n=>String(n).padStart(2,"0");return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`;}
function addDays(d,n){const x=new Date(d); x.setDate(x.getDate()+n); return x;}
function today0(){const t=new Date(); t.setHours(0,0,0,0); return t;}

function beautifyParagraphs(txt){
  const raw = String(txt||"").trim();
  if(!raw) return "";
  // <br>ã‚¿ã‚°ã¨ä½™è¨ˆãªæ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã€ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼ã®æ®µè½åˆ†ã‘ã«å¼·åˆ¶ã™ã‚‹
  const processedTxt = raw.replace(/<br\s*\/?>/gi, " ").replace(/[\r\n]+/g, "\n");
  
  // é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆæœ¬æ–‡ãŒç©ºæ¬„ã«ãªã‚‹ã®ã‚’é˜²ããŸã‚ã€æœ€ä½é™ã®æ®µè½åˆ†ã‘ã‚’è¡Œã†
  if (processedTxt.length > 900 || processedTxt.includes('å®¿å‘½ã®é­…æƒ‘åŠ›:')) {
      // é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆé …ç›®ã‚’å¼·èª¿è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ å‡¦ç†
      const headers = ['å®¿å‘½ã®é­…æƒ‘åŠ›', 'ä»Šæ—¥ã®ç•°æ€§é‹å‹¢', 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ¥æˆ¦ç•¥æŒ‡é‡', 'ç·æ‹¬ã¨çµè«–'];
      let content = processedTxt;
      
      let html = '';
      
      // å„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èµ·ç‚¹ã¨ã—ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†å‰²ã—ã€å€‹åˆ¥ã®æ®µè½ã¨ã—ã¦æ‰±ã†
      const sections = content.split(/(å®¿å‘½ã®é­…æƒ‘åŠ›:|ä»Šæ—¥ã®ç•°æ€§é‹å‹¢:|ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ¥æˆ¦ç•¥æŒ‡é‡:|ç·æ‹¬ã¨çµè«–:)/);
      
      let currentHeader = '';
      sections.forEach((segment, index) => {
          if (headers.some(h => segment.startsWith(h + ':'))) {
              currentHeader = segment.replace(':', '').trim();
          } else if (currentHeader && segment.trim().length > 0) {
              // ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã£ãŸå¾Œã®æ®µè½ï¼ˆæœ¬æ–‡ï¼‰ã‚’å‡¦ç†
              html += `<p class="sec"><strong>${currentHeader}</strong>ï¼š${esc(segment.trim())}</p>`;
              currentHeader = ''; // æ¬¡ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒæœ¬æ–‡ã§ã‚ã‚Œã°ã€å‰ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«çµåˆã™ã‚‹ãŸã‚ãƒªã‚»ãƒƒãƒˆ
          } else if (index === 0 && segment.trim().length > 0) {
              // æœ€åˆã®å‰æ–‡ï¼ˆãƒªãƒ¼ãƒ‰æ–‡ï¼‰ã‚’å‡¦ç†
              html += `<p class="sec"><strong>é‘‘å®šæ¦‚è¦</strong>ï¼š${esc(segment.trim())}</p>`;
          }
      });
      
      if (html === '') {
          // ä½•ã‚‚æŠ½å‡ºã§ããªã‹ã£ãŸå ´åˆã€å…¨æ–‡ã‚’å˜ä¸€ã®æ®µè½ã¨ã—ã¦è¿”ã™ï¼ˆæœ€çµ‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
          // AIã®å‡ºåŠ›ï¼ˆrawï¼‰ãŒãã®ã¾ã¾è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
          const errorMsg = "é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æœ¬æ–‡ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚";
          if (raw.length > 50) {
            return `<p class="sec"><strong>ã‚¨ãƒ©ãƒ¼</strong>ï¼š${errorMsg}<br>AIå‡ºåŠ›ã®å†’é ­ï¼š${esc(raw.substring(0, 200))}</p>`;
          }
          return `<p class="sec"><strong>ã‚¨ãƒ©ãƒ¼</strong>ï¼š${errorMsg}</p>`;
      }
      return html;
  }
  
  // é€šå¸¸ã®æ®µè½æ•´å½¢
  const sents = processedTxt.replace(/\s+/g," ").split(/(?<=ã€‚)/);
  const blocks=[]; let buf="";
  for(let i=0;i<sents.length;i++){
    buf+=sents[i];
    if(((i+1)%2===0)||sents[i].length>40){ blocks.push(buf.trim()); buf=""; }
  }
  if(buf.trim()) blocks.push(buf.trim());
  return blocks.map(p=>`<p class="sec">${esc(p)}</p>`).join("");
}


/* ========= font size ========= */
const mapSize={s:"size-s", m:"size-m", l:"size-l"};
function applySize(k){
  document.documentElement.classList.remove("size-s","size-m","size-l");
  document.documentElement.classList.add(mapSize[k]||"size-m");
  $("#fs-s").classList.toggle("active",k==="s");
  $("#fs-m").classList.toggle("active",k==="m");
  $("#fs-l").classList.toggle("active",k==="l");
  localStorage.setItem("fontSizeKey",k);
}
$("#fs-s").onclick=()=>applySize("s");
$("#fs-m").onclick=()=>applySize("m");
$("#fs-l").onclick=()=>applySize("l");
applySize(localStorage.getItem("fontSizeKey")||"m");

/* ========= birth selects (ä¿®æ­£) ========= */

const elYear=document.getElementById("year");
const elMonth=document.getElementById("month");
const elDay=document.getElementById("day");

function initBirth(){
  const now=new Date(); const yNow=now.getFullYear();
  
  // å¹´ã®é¸æŠè‚¢ç”Ÿæˆ
  for(let y=yNow; y>=yNow-100; y--) elYear.append(new Option(String(y),String(y)));
  // æœˆã®é¸æŠè‚¢ç”Ÿæˆ
  for(let m=1; m<=12; m++) elMonth.append(new Option(String(m),String(m)));
  
  // å¹´ã¨æœˆãŒå¤‰ã‚ã£ãŸæ™‚ã«æ—¥ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
  function fillDays(){
    const y=Number(elYear.value), m=Number(elMonth.value);
    // æœˆã®æœ€çµ‚æ—¥ã‚’å–å¾— (ä¾‹: 2025å¹´2æœˆ0æ—¥ -> 1æœˆ31æ—¥)
    const last=new Date(y,m,0).getDate(); 
    const keep=elDay.value;
    elDay.innerHTML="";
    for(let d=1; d<=last; d++) elDay.append(new Option(String(d),String(d)));
    // å¤‰æ›´å‰ã®å€¤ï¼ˆkeepï¼‰ãŒæ–°ã—ã„æœˆã®æœ€çµ‚æ—¥ã‚’è¶…ãˆã¦ã„ãªã‘ã‚Œã°ã€ãã®å€¤ã‚’ä¿æŒ
    if(keep && Number(keep)<=last) elDay.value=keep;
    else elDay.value=String(Math.min(last, new Date().getDate()));
    
    updateSexualMethodVisibility();
  }
  
  elYear.addEventListener("change",fillDays);
  elMonth.addEventListener("change",fillDays);
  
  // åˆæœŸå€¤è¨­å®š (èª•ç”Ÿæ—¥ã‚’20å¹´å‰ã®ä»Šæ—¥ã«è¨­å®š)
  elYear.value=String(yNow-20);  
  elMonth.value=String(now.getMonth()+1); // ç¾åœ¨ã®æœˆ
  fillDays(); // æ—¥ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
  elDay.value=String(now.getDate()); // ç¾åœ¨ã®æ—¥
}
// ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«åˆæœŸåŒ–ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
document.addEventListener("DOMContentLoaded", initBirth);
/* ========= birth selects ä¿®æ­£çµ‚ã‚ã‚Š ========= */


/* ========= age and sexual method control ========= */
function getAge(year, month, day) {
    const today = new Date();
    // month - 1ã§JavaScriptã®0-indexedã®æœˆã«åˆã‚ã›ã‚‹
    const birthDate = new Date(year, month - 1, day);
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    return age;
}
function updateSexualMethodVisibility() {
    const year = Number($("#year").value);
    const month = Number($("#month").value);
    const day = Number($("#day").value);
    const mode = document.body.dataset.mode;
    
    if (!year || !month || !day) return;
    
    const age = getAge(year, month, day);
    
    // è£ãƒ¢ãƒ¼ãƒ‰ã‹ã¤20æ­³ä»¥ä¸Šã§è¡¨ç¤º
    const isAdultAndUra = age >= 20 && mode === "ura";
    const elSexual = $("#sexualMethod");
    if (elSexual) {
        elSexual.style.display = isAdultAndUra ? 'inline-flex' : 'none';
        if (!isAdultAndUra && elSexual.querySelector('input').checked) {
            // æ¡ä»¶ã‚’æº€ãŸã•ãªã„å ´åˆã¯ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™
            elSexual.querySelector('input').checked = false;
        }
    }
}


/* ========= mode ========= */
const elSave=$("#saveToggle");
function setMode(mode){
  document.body.dataset.mode = mode==="ura"?"ura":"hon";
  $("#mode-hon").classList.toggle("active",document.body.dataset.mode==="hon");
  $("#mode-ura").classList.toggle("active",document.body.dataset.mode==="ura");
  updateSexualMethodVisibility();
  saveInputs();
}
$("#mode-hon").onclick=()=>setMode("hon");
$("#mode-ura").onclick=()=>setMode("ura");

/* ========= save/load ========= */
function getCheckedMethods(){
  return Array.from(document.querySelectorAll("#methods input:checked")).map(i=>i.value);
}
function saveInputs(){
  // å…¥åŠ›ã‚’ä¿å­˜ã™ã‚‹å‡¦ç†
  if(!elSave.checked) return;
  const data={
    year:$("#year").value, month:$("#month").value, day:$("#day").value,
    gender:$("#gender").value, theme:$("#theme").value,
    base:$("#base").value, wish:$("#wish").value,
    methods:getCheckedMethods(),
    mode:document.body.dataset.mode||"hon",
  };
  localStorage.setItem("fortunePref", JSON.stringify(data));
}
function loadInputs(){
  const raw=localStorage.getItem("fortunePref"); if(!raw) return;
  try{
    const o=JSON.parse(raw);
    
    // ãƒ­ãƒ¼ãƒ‰æ™‚ã«æ—¥ã‚’å†ç”Ÿæˆã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¿®æ­£
    const y=Number(o.year), m=Number(o.month); 
    if(y && m){
        const last=new Date(y,m,0).getDate();
        elDay.innerHTML=""; 
        for(let d=1; d<=last; d++) elDay.append(new Option(String(d),String(d)));
    }
    
    $("#year").value=o.year; 
    $("#month").value=o.month;
    $("#day").value=o.day;

    $("#gender").value=o.gender; $("#theme").value=o.theme;
    $("#base").value=o.base||""; $("#wish").value=o.wish||"";
    document.querySelectorAll("#methods input").forEach(i=>i.checked=o.methods?.includes(i.value));
    setMode(o.mode==="ura"?"ura":"hon");
    elSave.checked=true;
    
    document.body.classList.add("premium"); 
    updateSexualMethodVisibility();
  }catch(e){
      console.error("Failed to load inputs:", e);
      // ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ãŸã‚‰ä¿å­˜ã‚’ç„¡åŠ¹åŒ–
      elSave.checked=false;
  }
}
// DOMContentLoadedå¾Œã€initBirthã®å¾Œã«loadInputsã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã€initBirthã®å¾Œã«å‘¼ã³å‡ºã™
document.addEventListener("DOMContentLoaded", loadInputs);


/* ========= usage meter ========= */
const USAGE_KEY = "fortuneUsageCount";
let usageCount = Number(localStorage.getItem(USAGE_KEY)) || 0;
const elUsageCount = $("#usage-count");
if(elUsageCount){
    elUsageCount.textContent = usageCount;
}

function incrementUsageCount(){
    usageCount++;
    localStorage.setItem(USAGE_KEY, usageCount);
    if(elUsageCount) elUsageCount.textContent = usageCount;
}

/* ========= result renderers (å…¨ã¦ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ‡ã‚¶ã‚¤ãƒ³ã«çµ±ä¸€) ========= */
const adviceTitles = [
    {h: "â¤ï¸ æ‹æ„›ãƒ»å¯¾äººé‹ã®æŒ‡é‡", cls:"love"}, 
    {h: "ğŸ’¼ ä»•äº‹ãƒ»å­¦æ¥­é‹ã®æŒ‡é‡", cls:"work"}, 
    {h: "ğŸ’° é‡‘é‹ãƒ»çµŒæ¸ˆé¢ã®æŒ‡é‡", cls:"money"}, 
    {h: "ğŸ¥ å¥åº·ãƒ»ç”Ÿæ´»ç¿’æ…£ã®æŒ‡é‡", cls:"health"}, 
    {h: "âœ¨ ç²¾ç¥ãƒ»æ„è­˜ã«é–¢ã™ã‚‹æŒ‡é‡", cls:"spirit"}
];


// é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
function renderNormalResult(d){
    const title = esc(d.title||"é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆ");
    const lead  = esc(d.lead || "ä»Šæ—¥ã®é‹å‹¢ã¯ã€ã‚ãªãŸã«ã¨ã£ã¦é‡è¦ãªè»¢æ©Ÿã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚");
    const overviewHtml = beautifyParagraphs(d.overview);

    // 5ã¤ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const adviceHtml = d.advice?.map((adv, i) => {
        const info = adviceTitles[i] || {h: `ã‚¢ãƒ‰ãƒã‚¤ã‚¹ ${i+1}`, cls: 'spirit'};
        return `<div class="section ${info.cls}"><h4>${info.h}</h4><p class="sec">${esc(adv)}</p></div>`;
    }).join('');

    const warningsHtml = (d.warnings||[]).map(w => `<p class="sec">${esc(w)}</p>`).join('');
    
    const keywordsHtml = (d.keywords||[])
        .map(k => `<span class="chip">${esc(k)}</span>`)
        .join('');
        
    const chanceDaysHtml = (d.chance_days||[])
        .map(dateStr => {
            const date = new Date(dateStr);
            return `${date.getMonth()+1}/${date.getDate()} (${["æ—¥","æœˆ","ç«","æ°´","æœ¨","é‡‘","åœŸ"][date.getDay()]})`;
        }).join('ã€');
        
    // ç‰¹åŒ–å è¡“ç”¨ã®ã‚­ãƒ¼æƒ…å ±ã‚’å–å¾—ãƒ»è¡¨ç¤ºï¼ˆä¾‹: ã‚¿ãƒ­ãƒƒãƒˆã®ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰ï¼‰
    let specialInfoHtml = '';
    if (d.isSingleMethod) {
        if (d.key_card) {
            specialInfoHtml = `<div class="kpi" style="font-size:1rem; color:var(--love-text); border-color:var(--love-text);">ã‚­ãƒ¼ã‚«ãƒ¼ãƒ‰: ${esc(d.key_card)}</div>`;
        } else if (d.my_star && d.goshin) {
             specialInfoHtml = `<div class="kpi">æ—¥å¹²: ${esc(d.my_star)}</div><div class="kpi">äº”è¡Œ: ${esc(d.goshin)}</div>`;
        } else if (d.honmei_sei) {
            specialInfoHtml = `<div class="kpi">æœ¬å‘½æ˜Ÿ: ${esc(d.honmei_sei)}</div>`;
            if (d.getto_kibou) {
                specialInfoHtml += `<div class="kpi">ä»Šæœˆã®å‰æ–¹: ${esc(d.getto_kibou)}</div>`;
            }
        }
    }

    return `
        <div class="result-hero">
            <div class="eyebrow">é‘‘å®šæ›¸</div>
            <div class="title-line">${title}</div>
            <div class="lead">${lead}</div>
        </div>

        <div class="section">
            <h4>ğŸ“ ç·åˆé‘‘å®šãƒ¬ãƒãƒ¼ãƒˆ</h4>
            ${overviewHtml}
        </div>
        
        <div class="kpi-row">
            <div class="kpi">ãƒ©ãƒƒã‚­ãƒ¼ã‚«ãƒ©ãƒ¼: ${esc(d.lucky_color || "ä¸æ˜")}</div>
            <div class="kpi">ãƒ©ãƒƒã‚­ãƒ¼ãƒŠãƒ³ãƒãƒ¼: ${esc(d.lucky_number || "ä¸æ˜")}</div>
            ${specialInfoHtml}
            ${chanceDaysHtml ? `<div class="kpi">é‹å‘½ã®æ—¥: ${chanceDaysHtml}</div>` : ''}
        </div>

        ${adviceHtml}

        ${warningsHtml ? `<div class="section warn"><h4>âš ï¸ æ³¨æ„ã™ã¹ãã“ã¨</h4>${warningsHtml}</div>` : ''}
        
        <div class="section">
            <h4>ğŸ’¡ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼†ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h4>
            <div class="chips">${keywordsHtml || 'ï¼ˆç‰¹ã«ãªã—ï¼‰'}</div>
        </div>

        <div class="cta-row">
            <button class="cta" onclick="document.getElementById('bio').scrollIntoView({behavior:'smooth'})">ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã§æœªæ¥ã‚’ç¢ºã‹ã‚ã‚‹</button>
        </div>
    `;
}

// ãƒã‚¤ã‚ªãƒªã‚ºãƒ æç”»é–¢æ•°
function renderBiorhythm(biorhythmData) {
    const elDays = $("#days");
    elDays.innerHTML = ""; // åˆæœŸåŒ–

    const today = today0(); // æœ¬æ—¥0æ™‚ã®Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    const dayNames = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];

    biorhythmData.forEach((dayData) => {
        const date = new Date(dayData.date);
        const dayOfWeek = dayNames[date.getDay()];
        const dayClass = dayData.score >= 80 ? 's-good' : dayData.score >= 50 ? 's-mid' : 's-low';
        
        let emoji = '';
        if (date.getTime() < today.getTime()) {
             emoji = 'âœ…'; // éå»ã®æ—¥ä»˜ï¼ˆæœ¬æ¥ã¯è¡¨ç¤ºã—ãªã„ãŒã€ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        } else if (date.toDateString() === today.toDateString()) {
             emoji = 'â–¶ï¸'; // ä»Šæ—¥
        } else if (dayData.score >= 85) {
             emoji = 'â­'; // éå¸¸ã«è‰¯ã„æ—¥
        } else if (dayData.score >= 70) {
             emoji = 'ğŸ‘'; // è‰¯ã„æ—¥
        } else if (dayData.score >= 50) {
             emoji = 'ğŸ™‚'; // æ™®é€šã®æ—¥
        } else {
             emoji = 'ğŸ’§'; // ä½èª¿ãªæ—¥
        }
        
        // æ›œæ—¥ã”ã¨ã«è‰²åˆ†ã‘ã™ã‚‹ï¼ˆæ—¥æ›œæ—¥=èµ¤ã€åœŸæ›œæ—¥=é’ï¼‰
        const dayStyle = date.getDay() === 0 ? 'style="color:#ff6f6f;"' : date.getDay() === 6 ? 'style="color:#6496ff;"' : '';

        elDays.innerHTML += `
            <div class="cell">
                <div class="date" ${dayStyle}>${date.getMonth()+1}/${date.getDate()} (${dayOfWeek})</div>
                <div class="score ${dayClass}">${emoji} ${dayData.score}%</div>
            </div>
        `;
    });
}


// èª˜æƒ‘ã®ç§˜è¡“å°‚ç”¨ã®ç‰¹åˆ¥è¡¨ç¤º (JSONãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥èª­ã¿è¾¼ã‚€)
function renderSexualResult(d){
    const title = esc(d.title||"ç§˜ã‚ã‚‰ã‚ŒãŸé­…æƒ‘ã®é‘‘å®š");
    const lead  = esc(d.lead || "ã•ã‚ã€ç§ã¨ä¸€ç·’ã«æœ€é«˜ã®ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚");
    const overview = beautifyParagraphs(d.overview);
    
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰é€ã‚‰ã‚Œã¦ããŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥ä½¿ç”¨
    const rankings = d.sexualRankings || {};
    
    // ãƒ•ãƒ©ãƒƒãƒˆãªã‚­ãƒ¼åã§ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    const renderList = (key) => {
        const items = rankings[key] || [];
        // é …ç›®åãŒé•·ã„ãŸã‚ã€ã‚­ãƒ¼ã‹ã‚‰ä½™è¨ˆãªéƒ¨åˆ†ã‚’å–ã‚Šé™¤ã„ã¦è¡¨ç¤º
        return items.length > 0 
            ? items.map(item => `<li>${esc(item)}</li>`).join('') 
            : '<li>ï¼ˆçµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼‰</li>';
    };

    const time = esc(rankings.æ™‚é–“å¸¯ || "éå…¬é–‹");
    
    const flirts = (rankings.å£èª¬ãæ–‡å¥ || [])
        .map(f => `<span class="chip">${esc(f.trim().replace(/^[\-\*\d\.\)\s]*/, '').trim())}</span>`)
        .join('');
    
    // overviewã®å†…å®¹ã‚’ã€é‘‘å®šé …ç›®ã«åˆ†å‰²
    const overviewSections = overview.split(/<p class="sec">/g).filter(s => s.trim() !== '');

    const reportContent = (header) => {
        // AIãŒé …ç›®åã®å¾Œã«ã‚³ãƒ­ãƒ³ï¼ˆ:ï¼‰ã‚’ä»˜ã‘ã¦ã„ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã—ã¦æœ¬æ–‡ã‚’æŠ½å‡º
        const match = overviewSections.find(s => s.startsWith(header));
        if (match) {
            // å¤ªå­—ã®é …ç›®åã¨ãã®å¾Œã®ã‚³ãƒ­ãƒ³ã‚’é™¤å»ã—ã¦æœ¬æ–‡ã‚’æŠ½å‡º
            const body = match.replace(new RegExp(`^<strong>${header}</strong>ï¼š`), '').trim();
            // æ”¹è¡Œã‚’è¨±å®¹ã—ã€å¤ªå­—ã§é …ç›®åã‚’å¼·èª¿
            return `<p class="sec"><strong>${header}</strong>ï¼š${body}</p>`;
        }
        return `<p class="sec"><strong>${header}</strong>ï¼šé‘‘å®šãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚</p>`;
    };

    // ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆæ‹æ„›ãƒ»å¯¾äººé‹ã®æŒ‡é‡ï¼‰ã®æœ€åˆã®1ä»¶ç›®ã®ã¿ã‚’å–å¾—ã—ã€ç·æ‹¬ã¨ã—ã¦ä½¿ç”¨
    const finalAdvice = esc((Array.isArray(d.advice) && d.advice.length > 0) ? d.advice[0] : "ç§˜è¡“ã¯æ•™ãˆãŸã‚ã€‚ã‚ã¨ã¯ã‚ãªãŸã®æ‰‹ã«ã‹ã‹ã£ã¦ã„ã‚‹ã‚ã‚ˆã€‚ãƒ•ãƒ•ãƒƒã€‚");
    
    return `
    <div class="result-hero" style="border-color:#ff99d0; background:radial-gradient(1000px 400px at 50% -10%, rgba(255,100,160,.3), rgba(255,100,160,0) 55%), linear-gradient(180deg, rgba(255,170,230,.08), rgba(255,170,230,.02))">
      <div class="eyebrow" style="color:#ff99d0;">é­…æƒ‘ã®ç§˜è¡“ï¼šFINAL REPORT</div>
      <div class="title-line" style="background:linear-gradient(90deg,#ffd8f0,#ff99d0,#ffd8f0); -webkit-background-clip:text;">${title}</div>
      <div class="lead" style="color:#ff99d0;">${lead}</div>
    </div>

    <div class="section love">
      <h4>â¤ï¸ ä»Šæ—¥ã®ã‚»ã‚¯ã‚·ãƒ£ãƒ«é‹ï¼ˆé‘‘å®šãƒ¬ãƒãƒ¼ãƒˆï¼‰</h4>
      
      <div class="report-content">
          ${reportContent('å®¿å‘½ã®é­…æƒ‘åŠ›')}
          ${reportContent('ä»Šæ—¥ã®ç•°æ€§é‹å‹¢')}
          ${reportContent('ã‚¿ãƒ¼ã‚²ãƒƒãƒˆåˆ¥æˆ¦ç•¥æŒ‡é‡')}
          ${reportContent('ç·æ‹¬ã¨çµè«–')}
      </div>
    </div>
    
    <div class="grid g4" style="margin-top:20px; grid-template-columns:1fr 1fr;">
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ’„ å£ç´…ã®è‰² TOP3</h4>
                <ul style="margin:0;">${renderList('å£ç´…ã®è‰²')}</ul>
            </div>
        </div>
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ‘™ ä¸‹ç€ã®è‰² TOP3</h4>
                <ul style="margin:0;">${renderList('ä¸‹ç€ã®è‰²')}</ul>
            </div>
        </div>
        
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ‘ƒ é¦™æ°´ã®ç³»çµ± TOP3</h4>
                <ul style="margin:0;">${renderList('é¦™æ°´ã®ç³»çµ±')}</ul>
            </div>
        </div>
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ‘€ è¦–ç·šã®é€ã‚Šæ–¹ TOP3</h4>
                <ul style="margin:0;">${renderList('è¦–ç·šã®é€ã‚Šæ–¹')}</ul>
            </div>
        </div>
        
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ‘— ä»Šæ—¥ã®å‹è² æœ TOP3</h4>
                <ul style="margin:0;">${renderList('ä»Šæ—¥ã®å‹è² æœï¼ˆå…·ä½“çš„ã‚¢ã‚¤ãƒ†ãƒ ï¼‰')}</ul>
            </div>
        </div>
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ’‡â€â™€ï¸ ä»Šæ—¥ã®å‹è² é«ª TOP3</h4>
                <ul style="margin:0;">${renderList('ä»Šæ—¥ã®å‹è² é«ªï¼ˆå…·ä½“çš„ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰')}</ul>
            </div>
        </div>
        
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ’ ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ TOP3</h4>
                <ul style="margin:0;">${renderList('ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ï¼ˆå®çŸ³ãƒ»é‡‘å±ï¼‰')}</ul>
            </div>
        </div>
        
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ“ ãŠã™ã™ã‚ãƒ‡ãƒ¼ãƒˆå ´æ‰€ TOP3</h4>
                <ul style="margin:0;">${renderList('ãŠã™ã™ã‚ãƒ‡ãƒ¼ãƒˆå ´æ‰€')}</ul>
            </div>
        </div>
        <div class="col-2">
            <div class="section" style="padding:18px; border-color:var(--love-text); background:var(--love-bg);">
                <h4>ğŸ½ ãŠã™ã™ã‚ã”é£¯ TOP3</h4>
                <ul style="margin:0;">${renderList('ãŠã™ã™ã‚ã”é£¯ã®ã‚¸ãƒ£ãƒ³ãƒ«')}</ul>
            </div>
        </div>
    </div>

    <div class="section" style="margin-top:12px;">
      <h4>â± æœ€é«˜ã®é‹å‘½ã‚’æ´ã‚€æ™‚é–“</h4>
      <div class="kpi-row" style="margin-top:0;">
        <div class="kpi" style="color:#ff99d0; border-color:#ff99d0; background:rgba(255,153,208,.10); font-size:1.1rem;">æœ€å¼·ã®æ™‚é–“å¸¯ï¼š${time}</div>
      </div>
    </div>
    
    <div class="section">
        <h4>ğŸ’Œ ç²ç‰©ã‚’è½ã¨ã™æœ€çµ‚å£èª¬ãæ–‡å¥</h4>
        <div class="chips">${flirts}</div>
    </div>
    
    <div class="section love" style="border-color:#ff66b2; background:linear-gradient(180deg, rgba(255,179,202,.12), rgba(255,170,230,.3));">
        <h4>ãƒ•ãƒ•ãƒƒâ€¦ æœ€å¾Œã®ä»•ä¸Šã’ã‚ˆ</h4>
        <p class="sec" style="color:#ffb3ca;">${finalAdvice}</p>
    </div>
    
    <div class="cta-row">
      <button class="cta" onclick="document.getElementById('bio').scrollIntoView({behavior:'smooth'})">ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã§æœªæ¥ã‚’ç¢ºã‹ã‚ã‚‹</button>
    </div>`;
}

/* ========= main logic - å ã†å‡¦ç†ã¨æç”»ã®çµ±åˆ (ä¿®æ­£ãƒ»å†è¿½åŠ ) ========= */
const elRun = $("#run");
const elRes = $("#res");
const elBio = $("#bio");
const elDays = $("#days");

async function runFortune(){
    // æ¼”å‡ºç”¨ã®é–¢æ•°
    const setLoadMessage = (msg) => {
        elRes.innerHTML = `<p class='note' style="padding: 10px; font-size: 1rem; color: var(--accent); animation: pulse 1s infinite alternate;">${msg}</p>`;
    };
    
    // ãƒ­ãƒ¼ãƒ‰ä¸­ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆCSSã«ä¾å­˜ã—ãªã„ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ¼”å‡ºï¼‰
    if (!$('#pulse-style')) {
        const style = document.createElement('style');
        style.id = 'pulse-style';
        style.innerHTML = '@keyframes pulse { from { opacity: 0.6; } to { opacity: 1.0; } }';
        document.head.appendChild(style);
    }

    setLoadMessage("âœ¨ é‹å‘½ã®æ˜Ÿã«æ¥ç¶šä¸­...ï¼ˆæ•°ç§’ãŠå¾…ã¡ãã ã•ã„ï¼‰");
    elBio.style.display = 'none'; // æ–°ã—ã„å ã„ã‚’é–‹å§‹ã™ã‚‹éš›ã«ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã‚’éè¡¨ç¤ºã«ã™ã‚‹
    elDays.innerHTML = ''; 
    elRun.disabled = true;

    try{
        // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®åé›†
        const birth = `${$("#year").value}-${String($("#month").value).padStart(2, '0')}-${String($("#day").value).padStart(2, '0')}`;
        const gender = $("#gender").value;
        const theme = $("#theme").value;
        const baseResult = $("#base").value;
        const wish = $("#wish").value;
        const methods = getCheckedMethods(); // æ—¢å­˜é–¢æ•°ã‚’ä½¿ç”¨
        const mode = document.body.dataset.mode;

        // ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹å‰ã®æ¼”å‡º
        setLoadMessage("ğŸ”® é¸æŠã•ã‚ŒãŸå è¡“ã§é‹å‘½ã‚’è§£æä¸­...");

        // 2. ã‚µãƒ¼ãƒãƒ¼ã¸POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆ
        const response = await fetch('/fortune', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ birth, gender, theme, baseResult, wish, methods, mode })
        });

        if(!response.ok) {
             const errorText = await response.text();
             throw new Error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: " + response.status + " / è©³ç´°: " + errorText.substring(0, 100));
        }
        
        const json = await response.json();
        
        // ã‚¹ãƒ†ãƒƒãƒ—2: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å¿œç­”ã‚’å¾…ã¤é–“ã®æ¼”å‡ºï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯æ¥ãŸãŒJSONè§£æå‰ï¼‰
        setLoadMessage("ğŸ“ AIãŒé‘‘å®šãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆä¸­...ï¼ˆå¤§é‹ãƒ»å°é‹ã‚’ç²¾æŸ»ï¼‰");

        if(!json.ok) {
            // ã‚µãƒ¼ãƒãƒ¼å´ã§JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ãªã©ãŒç™ºç”Ÿã—ãŸå ´åˆ
            let errorMsg = "APIå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
            if(json.raw && json.raw.length > 50) {
                 errorMsg += `ã€‚AIã®ç”Ÿã®å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼‰ã®å†’é ­: ${esc(json.raw.substring(0, 200))}`;
            }
            throw new Error(errorMsg);
        }
        
        const d = json.data;
        const validData = d.title && d.overview && d.advice?.length > 0;
        
        if (!validData) {
             throw new Error(`é‘‘å®šãƒ¬ãƒãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãŒä¸å®Œå…¨ã§ã™ã€‚AIå‡ºåŠ›ã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`);
        }

        // 3. çµæœã®æç”»
        if (d.isSexualActive) {
            elRes.innerHTML = renderSexualResult(d);
        } else {
            elRes.innerHTML = renderNormalResult(d);
        }

        // 4. ãƒã‚¤ã‚ªãƒªã‚ºãƒ ã®æç”»
        renderBiorhythm(d.biorhythm);
        elBio.style.display = 'block';

        // 5. åˆ©ç”¨å›æ•°ã®æ›´æ–°
        incrementUsageCount(); // æ—¢å­˜é–¢æ•°ã‚’ä½¿ç”¨
        // çµæœè¡¨ç¤ºå¾Œã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        elRes.scrollIntoView({ behavior: 'smooth' });

    } catch(e) {
        console.error("å ã„å‡¦ç†ã‚¨ãƒ©ãƒ¼:", e);
        // ã‚¨ãƒ©ãƒ¼ã‚’èµ¤å­—ã§å¤§ããè¡¨ç¤º
        elRes.innerHTML = `<div class="result-hero" style="border-color:#ff6f6f; background:radial-gradient(1000px 400px at 50% -10%, rgba(255,100,100,.2), rgba(255,100,100,0) 55%);">
          <div class="eyebrow" style="color:#ff6f6f;">ERROR</div>
          <div class="title-line" style="background:linear-gradient(90deg,#ff8888,#ff6f6f,#ff8888); -webkit-background-clip:text;">é‘‘å®šå¤±æ•—</div>
          <div class="lead" style="color:#ff6f6f;">${esc(e.message)}</div>
          <p class="sec" style="color:#ffc266; margin-top:10px;">ï¼ˆé–‹ç™ºè€…å‘ã‘ï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è©³ç´°æƒ…å ±ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã™ï¼‰</p>
        </div>`;
        elBio.style.display = 'none';
    } finally {
        elRun.disabled = false;
    }
}

// ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰²ã‚Šå½“ã¦
elRun.onclick = runFortune;
</script>